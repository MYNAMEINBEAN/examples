<!DOCTYPE html>
<html>
  <head>
    <style>
      .resize-drag {
        width: 1280px;
        height: 720px;
        padding: 20px;
        margin: 1rem;
        background-color: #29e;
        color: white;
        font-size: 20px;
        font-family: sans-serif;

        touch-action: none;

        /* This makes things *much* easier */
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <button id="lock">Unlock</button>
    <div id="cloudComputerDiv" class="resize-drag">Resize from any edge or corner</div>
    <script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
    <script type="module">
      import Hyperbeam from 'https://unpkg.com/@hyperbeam/web@latest/dist/index.js'

      function dragMoveListener(event) {
        const target = event.target;
        const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
        const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

        target.style.transform = `translate(${x}px, ${y}px)`;
        target.setAttribute('data-x', x);
        target.setAttribute('data-y', y);
      }

      function toggleInteractives() {
        if (lock.innerText === 'Lock') {
          lock.innerText = 'Unlock'
          interact('.resize-drag').unset()
          return
        }
        lock.innerText = 'Lock'
        interact('.resize-drag')
          .resizable({
            edges: { left: true, right: true, bottom: true, top: true },
            listeners: {
              move (event) {
                const target = event.target
                let x = (parseFloat(target.getAttribute('data-x')) || 0)
                let y = (parseFloat(target.getAttribute('data-y')) || 0)

                target.style.width = event.rect.width + 'px'
                target.style.height = event.rect.height + 'px'

                x += event.deltaRect.left
                y += event.deltaRect.top

                target.style.transform = 'translate(' + x + 'px,' + y + 'px)'
                target.setAttribute('data-x', x)
                target.setAttribute('data-y', y)
              }
            },
            modifiers: [
              interact.modifiers.restrictSize({
                min: { width: 100, height: 50 }
              })
            ],
            inertia: true
          })
          .draggable({
            listeners: { move: dragMoveListener },
            inertia: true,
          });
      }

      lock.addEventListener('click', toggleInteractives)
      const resp = await fetch('/computer')
      const data = await resp.json()
      const hb = await Hyperbeam(cloudComputerDiv, data.embed_url)
      toggleInteractives()
    </script>
    </div>
  </body>
</html>
